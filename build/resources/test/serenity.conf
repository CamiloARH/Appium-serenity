
webdriver {
  driver = provided
  provided {
      type = mydriver
      mydriver = co.com.pragma.utils.MyAndroidDriver
    }

#  timeouts {
#    implicitlywait = 5000
#    fluentwait = 10000
#  }
  timeouts {
      implicitlywait = 20000
      fluentwait = 25000
    }

  # CAPABILITIES W3C (Formato plano con prefijos para máxima compatibilidad)
  capabilities {
    platformName = "Android"
    browserName = "Chrome"

    # Prefijos obligatorios para Appium 2+
    "appium:automationName" = "UiAutomator2"
    "appium:deviceName" = "emulator-5554"
    "appium:chromedriverAutodownload" = true
    "appium:nativeWebScreenshot" = true
    "appium:newCommandTimeout" = 800
    "appium:autoGrantPermissions" = true
  }
}

serenity {
  project.name = "Pragma Mobile Automation"
  logging = "VERBOSE"
  take.screenshots = "AFTER_EACH_STEP"
}

# =========================================================
# GESTIÓN DE ENTORNOS (OVERRIDES)
# =========================================================
environments {

  # 1. LOCAL: APP (PLAY STORE)
  # Se activa con: -Denvironment=local_app
  local_app {
    webdriver {
      driver = appium
      remote.url = "http://127.0.0.1:4723/"
    }

    # Sobrescribimos capabilities para quitar el navegador y poner la App
    webdriver.capabilities {
      browserName = "" # Importante: Borra 'Chrome' para que no confunda a Appium
      platformName = "Android"
      "appium:automationName" = "UiAutomator2"
      "appium:deviceName" = "emulator-5554"
      "appium:appPackage" = "com.android.vending"
      "appium:appActivity" = "com.google.android.finsky.activities.MainActivity"
      "appium:noReset" = true
      "appium:autoGrantPermissions" = true
    }
  }

  # 2. BROWSERSTACK: WEB
  # Se activa con: -Denvironment=android_web
  android_web {
    webdriver {
      driver = remote
      remote.url = "https://hub-cloud.browserstack.com/wd/hub"
    }
    capabilities {
      browserName = "Chrome"
      "bstack:options" {
        osVersion = "13.0"
        deviceName = "Samsung Galaxy S23"
        local = "false"
        projectName = "Pragma Web Test"
      }
    }
  }

  # 3. BROWSERSTACK: APP
  # Se activa con: -Denvironment=android_app
  android_app {
    webdriver {
      driver = remote
      remote.url = "https://hub-cloud.browserstack.com/wd/hub"
    }
    capabilities {
      "bstack:options" {
        osVersion = "12.0"
        deviceName = "Google Pixel 6 Pro"
        projectName = "Pragma App Test"
      }
      "appium:appPackage" = "com.android.vending"
      "appium:appActivity" = "com.google.android.finsky.activities.MainActivity"
      "appium:automationName" = "UIAutomator2"
      autoGrantPermissions = true
    }
  }
}