# --- CONFIGURACIÓN GLOBAL ---
webdriver {
  timeouts {
    implicitlywait = 5000
    fluentwait = 10000
  }
}

serenity {
  project.name = "Pragma Mobile Automation"
  logging = VERBOSE
  take.screenshots = AFTER_EACH_STEP
}

# --- GESTIÓN DE ENTORNOS ---
environments {

  # 1. BROWSERSTACK: Web (Serebii)
  android_web {
    webdriver {
      driver = remote
      remote.url = "https://hub-cloud.browserstack.com/wd/hub"
    }
    capabilities {
      "bstack:options" {
        osVersion = "13.0"
        deviceName = "Samsung Galaxy S23"
        local = "false"
        projectName = "Pragma Web Test"
      }
      browserName = "Chrome"
    }
  }

  # 2. BROWSERSTACK: App (Play Store)
  android_app {
    webdriver {
      driver = remote
      remote.url = "https://hub-cloud.browserstack.com/wd/hub"
    }
    capabilities {
      "bstack:options" {
        osVersion = "12.0"
        deviceName = "Google Pixel 6 Pro"
        projectName = "Pragma App Test"
      }
      "appium:appPackage" = "com.android.vending"
      "appium:appActivity" = "com.google.android.finsky.activities.MainActivity"
      "appium:automationName" = "UIAutomator2"
      autoGrantPermissions = true
    }
  }

  # 3. LOCAL: Web (Serebii) - CORREGIDO
      local_web {
          webdriver {
            driver = appium
            remote.url = "http://127.0.0.1:4723"
          }
          capabilities {
            platformName = "Android"
            "appium:options" {
              automationName = "UiAutomator2"
              browserName = "Chrome"
              deviceName = "emulator-5554"
              nativeWebScreenshot = true
              newCommandTimeout = 800
              chromedriverAutodownload = true
            }
          }
        }

      # 4. LOCAL: App (Play Store) - OPTIMIZADO W3C
      local_app {
        webdriver {
          driver = appium
          remote.url = "http://127.0.0.1:4723"
        }

        capabilities {
          platformName = "Android"
          "appium:options" {
            automationName = "UiAutomator2"
            deviceName = "emulator-5554"
            appPackage = "com.android.vending"
            appActivity = "com.google.android.finsky.activities.MainActivity"
            noReset = true
            # autoGrantPermissions es muy útil en local para evitar popups del sistema
            autoGrantPermissions = true
          }
        }
      }
}